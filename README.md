# The Last of Guss

"The Last of Guss" — это соревновательная браузерная игра, в которой игроки нажимают на виртуального гуся, чтобы набрать очки и побороться за первое место в ограниченных по времени раундах.

## Демонстрация

[Ссылка на живую демонстрацию] (если доступно)

_(Здесь можно разместить GIF или скриншоты игрового процесса)_

## Технологический стек

- **Бэкенд:** Node.js, NestJS, TypeScript (strict mode), PostgreSQL, Prisma ORM
- **Фронтенд:** React, TypeScript, Vite, React Router, Shadcn/UI, Tailwind CSS, Zustand
- **Аутентификация:** JWT-токены, хранящиеся в HttpOnly cookie

## Архитектура

Приложение спроектировано с учетом масштабируемости и консистентности данных.

- **Масштабируемость:** Бэкенд является stateless, что позволяет запускать его в нескольких экземплярах за реверс-прокси, подключенных к одной базе данных. Сессии пользователей не привязаны к конкретному экземпляру сервера.
- **Консистентность данных:** Для обработки одновременных нажатий и обеспечения целостности данных приложение использует транзакции базы данных для критически важных операций.
- **Развертывание:** Продакшн-сборка предназначена для запуска простой командой `node dist/index.js`. Архитектура дружелюбна к контейнеризации, хотя Docker-файлы не включены в этот проект.

## Установка и запуск

Чтобы запустить проект локально, выполните следующие шаги:

1.  **Клонируйте репозиторий:**

    ```sh
    git clone <URL-репозитория>
    cd the-last-of-guss
    ```

2.  **Установите зависимости:**
    Этот проект является монорепозиторием. Установите зависимости как для бэкенда, так и для фронтенда из корневого каталога.

    ```sh
    npm install
    ```

3.  **Настройте переменные окружения:**
    Создайте файл `.env` в каталоге бэкенд-проекта (например, `the-last-of-guss-backend/.env`). Он должен содержать следующие переменные:

    ```env
    DATABASE_URL="postgresql://USER:PASSWORD@HOST:PORT/DATABASE"
    JWT_SECRET="your_super_secret_key"
    ROUND_DURATION=60000 # в миллисекундах (например, 60 секунд)
    COOLDOWN_DURATION=10000 # в миллисекундах (например, 10 секунд)
    ```

4.  **Примените схему базы данных:**
    Выполните команду Prisma для синхронизации схемы вашей базы данных.

    ```sh
    npx prisma db push
    ```

5.  **Запустите приложение:**

    - **Сборка проекта:**
      ```sh
      npm run build
      ```
    - **Запуск сервера:**
      ```sh
      npm start
      ```
    - **Запуск фронтенда (для разработки):**
      ```sh
      npm run dev # (в каталоге фронтенда)
      ```

6.  **Запустите тесты:**
    ```sh
    npm test
    ```

## Документация API

API построено на NestJS и включает управление доступом на основе ролей. Спецификация Swagger/OpenAPI доступна по эндпоинту `/api` при запущенном сервере.

### Ключевые эндпоинты

- `POST /auth/register`: Регистрация нового пользователя.
- `POST /auth/login`: Вход в систему и получение HttpOnly JWT cookie.
- `GET /rounds`: Получение списка всех игровых раундов.
- `GET /rounds/:id`: Получение подробной информации о конкретном раунде.
- `POST /rounds`: Создание нового раунда (только для администраторов).
- `POST /rounds/:id/tap`: Регистрация нажатия (тапа) в текущем активном раунде.

## Особенности реализации

- **Управление доступом на основе ролей (RBAC):** Пользователи могут иметь разные роли (`USER`, `ADMIN`, `NIKITA`), которые предоставляют различные разрешения. Например, только пользователи с ролью `ADMIN` могут создавать новые раунды. Роль `NIKITA` — это особый случай для демонстрации, при котором нажатия не засчитываются.
- **Безопасная аутентификация:** Используются JWT, хранящиеся в `HttpOnly` cookie, для защиты от XSS-атак. `JwtAuthGuard` защищает чувствительные эндпоинты.
- **Транзакционные операции:** Основная игровая механика нажатий обрабатывается в рамках транзакции Prisma (`$transaction`), чтобы обеспечить атомарность подсчета очков и записи нажатий, предотвращая состояния гонки.
- **Управление конфигурацией:** Конфигурация приложения (например, продолжительность раунда) управляется через модуль `@nestjs/config`, что позволяет легко изменять параметры через переменные окружения.

## Автор

[Victor Zadorozhnyy / [Профиль на GitHub](https://github.com/Antibioticvz)]
